<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gym & Nutrition Tracker</title>
<style>
  :root{--bg:#fff;--fg:#111;--muted:#666;--b:#e5e7eb;--pill:#f6f7f9;}
  *{box-sizing:border-box} body{margin:0;font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg)}
  header{padding:16px;border-bottom:1px solid var(--b);display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  h1{margin:0;font-size:20px}
  .row{display:flex;gap:8px;align-items:center}
  input,select,button{border:1px solid var(--b);border-radius:10px;padding:8px 10px;background:#fff}
  button{cursor:pointer}
  .tabs{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;border-bottom:1px solid var(--b);padding:8px}
  .tab{padding:10px;border:1px solid var(--b);border-radius:10px;background:var(--pill)}
  .tab.active{background:#111;color:#fff}
  main{max-width:1100px;margin:0 auto;padding:16px}
  .card{border:1px solid var(--b);border-radius:16px;padding:12px;margin:8px 0}
  .grid{display:grid;gap:12px}
  .grid-2{grid-template-columns:1fr 1fr}
  .pill{border:1px solid var(--b);border-radius:999px;padding:6px 10px;display:inline-flex;gap:8px;align-items:center;background:var(--pill)}
  .muted{color:var(--muted)}
  .bar{width:100%;height:8px;background:#eee;border-radius:999px;overflow:hidden}
  .fill{height:8px;background:#111}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
</style>
</head>
<body>
  <header>
    <h1>Gym & Nutrition Tracker</h1>
    <div class="row">
      <label class="muted">Date</label>
      <input id="dateInput" type="date"/>
      <button id="exportBtn">Export</button>
      <input id="importFile" type="file" accept="application/json" style="display:none"/>
      <button id="importBtn">Import</button>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="workout">Workout</button>
    <button class="tab" data-tab="food">Food</button>
    <button class="tab" data-tab="energy">Energy</button>
    <button class="tab" data-tab="measure">Measurements</button>
    <button class="tab" data-tab="insights">Insights</button>
  </nav>

  <main id="app"></main>

  <!-- React via CDN -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <!-- IMPORTANT: include data-presets so JSX compiles -->
  <script type="text/babel" data-presets="env,react">
    const {useState,useEffect,useMemo} = React;

    const todayISO = () => new Date().toISOString().slice(0,10);
    const uid = () => Math.random().toString(36).slice(2);

    function useLocalStorage(key, initial){
      const [value,setValue] = React.useState(()=>{try{const r=localStorage.getItem(key);return r?JSON.parse(r):initial}catch{return initial}});
      React.useEffect(()=>{try{localStorage.setItem(key, JSON.stringify(value))}catch{}},[key,value]);
      return [value,setValue];
    }

    const DEFAULT_EXERCISES = [
      {id:uid(),name:"Barbell Bench Press",category:"Chest"},
      {id:uid(),name:"Incline Dumbbell Press",category:"Chest"},
      {id:uid(),name:"Dumbbell Chest Press",category:"Chest"},
      {id:uid(),name:"Decline Bench Press",category:"Chest"},
      {id:uid(),name:"Cable Fly (High-to-Low)",category:"Chest"},
      {id:uid(),name:"Push-up",category:"Chest"},
      {id:uid(),name:"Lat Pulldown",category:"Back"},
      {id:uid(),name:"Pull-up",category:"Back"},
      {id:uid(),name:"Seated Cable Row",category:"Back"},
      {id:uid(),name:"One-Arm Dumbbell Row",category:"Back"},
      {id:uid(),name:"T-Bar Row",category:"Back"},
      {id:uid(),name:"Deadlift (Conventional)",category:"Back"},
      {id:uid(),name:"Back Squat",category:"Legs"},
      {id:uid(),name:"Front Squat",category:"Legs"},
      {id:uid(),name:"Leg Press",category:"Legs"},
      {id:uid(),name:"Romanian Deadlift",category:"Legs"},
      {id:uid(),name:"Walking Lunge",category:"Legs"},
      {id:uid(),name:"Hip Thrust",category:"Legs"},
      {id:uid(),name:"Leg Extension",category:"Legs"},
      {id:uid(),name:"Seated Leg Curl",category:"Legs"},
      {id:uid(),name:"Standing Calf Raise",category:"Legs"},
      {id:uid(),name:"Overhead Press (Barbell)",category:"Shoulders"},
      {id:uid(),name:"Dumbbell Shoulder Press",category:"Shoulders"},
      {id:uid(),name:"Lateral Raise",category:"Shoulders"},
      {id:uid(),name:"Arnold Press",category:"Shoulders"},
      {id:uid(),name:"Barbell Curl",category:"Arms"},
      {id:uid(),name:"Hammer Curl",category:"Arms"},
      {id:uid(),name:"Triceps Pushdown",category:"Arms"},
      {id:uid(),name:"Dips",category:"Arms"},
      {id:uid(),name:"Plank",category:"Core"},
      {id:uid(),name:"Hanging Leg Raise",category:"Core"},
      {id:uid(),name:"Cable Crunch",category:"Core"},
    ];

    const DEFAULT_FOODS = [
      { id: uid(), name: "Chicken Breast (raw)", unit:"g", per:100, kcal:120, protein:23, carbs:0, fat:2 },
      { id: uid(), name: "White Rice (cooked)", unit:"g", per:100, kcal:130, protein:2.7, carbs:28, fat:0.3 },
      { id: uid(), name: "Avocado", unit:"g", per:100, kcal:160, protein:2, carbs:9, fat:15 },
      { id: uid(), name: "Protein Powder (scoop)", unit:"scoop", per:30, kcal:120, protein:24, carbs:3, fat:1.5 },
    ];

    const DEFAULT_SETTINGS = { macroTargets:{kcal:2600,protein:180,carbs:260,fat:80}, units:{weight:"kg"} };

    function App(){
      const [tab,setTab] = useState("workout");
      const [date,setDate] = useState(todayISO());
      const [exercises,setExercises] = useLocalStorage("fit.exercises", DEFAULT_EXERCISES);
      const [workouts,setWorkouts] = useLocalStorage("fit.workouts", []);
      const [foods,setFoods] = useLocalStorage("fit.foods", DEFAULT_FOODS);
      const [foodLogs,setFoodLogs] = useLocalStorage("fit.foodLogs", []);
      const [energyLogs,setEnergyLogs] = useLocalStorage("fit.energyLogs", []);
      const [measurements,setMeasurements] = useLocalStorage("fit.measurements", []);
      const [settings,setSettings] = useLocalStorage("fit.settings", DEFAULT_SETTINGS);
      const [activeExerciseId,setActiveExerciseId] = useState(exercises[0]?.id||"");

      // Hook up header controls
      useEffect(()=>{
        const dateInput=document.getElementById("dateInput");
        if(dateInput && !dateInput.value) dateInput.value = date;
        const onChange = (e)=>setDate(e.target.value);
        dateInput?.addEventListener("change", onChange);
        return ()=>dateInput?.removeEventListener("change", onChange);
      },[]);

      useEffect(()=>{
        const exportBtn=document.getElementById("exportBtn");
        const importBtn=document.getElementById("importBtn");
        const importFile=document.getElementById("importFile");
        const onExport=()=>{
          const all={exercises,workouts,foods,foodLogs,energyLogs,measurements,settings};
          const blob=new Blob([JSON.stringify(all,null,2)],{type:"application/json"});
          const url=URL.createObjectURL(blob); const a=document.createElement("a");
          a.href=url; a.download=`gym-tracker-export-${todayISO()}.json`; a.click(); URL.revokeObjectURL(url);
        };
        const onImportClick=()=>importFile.click();
        const onImport=e=>{
          const f=e.target.files?.[0]; if(!f) return;
          const r=new FileReader(); r.onload=(ev)=>{try{
            const data=JSON.parse(ev.target.result);
            if(data.exercises) setExercises(data.exercises);
            if(data.workouts) setWorkouts(data.workouts)

